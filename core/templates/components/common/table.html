{% load components %}

{# Componente de Tabela Reutilizável com Card #}
{% comment %} 
    Parâmetros:
    - card_title: Título do card (opcional)
    - card_actions: Lista de dicionários com ações do card (opcional):
        - label: Texto do botão
        - url: URL do link
        - icon: SVG do ícone (opcional)
        - class: Classes CSS adicionais (opcional, padrão: 'btn-primary')
    - table_id: ID do elemento da tabela para HTMX (opcional)
    - headers: Lista de dicionários com configurações de colunas
    - rows: QuerySet ou lista de objetos
    - actions_template: Template para ações da linha (opcional)
    - actions_cell_type: Tipo de célula para ações (opcional)
    - empty_message: Mensagem quando não há dados
    - row_class_field: Campo para classe CSS da linha (opcional)
{% endcomment %}

<div class="card">
    {% if card_title or card_actions %}
        <div class="card-header">
            {% if card_title %}
                <h3 class="card-title">{{ card_title }}</h3>
            {% endif %}
            {% if card_actions %}
                <div class="card-actions">
                    {% for action in card_actions %}
                        {% render_button label=action.label variant=action.variant|default:'primary' href=action.url icon=action.icon size=action.size extra_classes=action.extra_classes %}
                    {% endfor %}
                </div>
            {% endif %}
        </div>
    {% endif %}
    
    <div class="table-responsive" {% if table_id %}id="{{ table_id }}"{% endif %}>
        <table class="table table-vcenter table-mobile-md card-table">
            <thead>
                <tr>
                    {% for header in headers %}
                        <th {% if header.width %}class="{{ header.width }}"{% endif %}>
                            {{ header.label }}
                        </th>
                    {% endfor %}
                    {% if actions_template %}
                        <th class="w-1"></th>
                    {% endif %}
                </tr>
            </thead>
            <tbody>
                {% for row in rows %}
                    <tr {% if row_class_field %}class="{{ row|get_attr:row_class_field }}"{% endif %}>
                        {% for header in headers %}
                            <td data-label="{{ header.label }}">
                                {% if header.template and header.cell_type %}
                                    {% include header.template with cell_type=header.cell_type object=row only %}
                                {% elif header.template %}
                                    {% include header.template with object=row %}
                                {% else %}
                                    {{ row|get_attr:header.field|default:"" }}
                                {% endif %}
                            </td>
                        {% endfor %}
                        {% if actions_template and actions_cell_type %}
                            <td>
                                {% include actions_template with cell_type=actions_cell_type object=row only %}
                            </td>
                        {% elif actions_template %}
                            <td>
                                {% include actions_template with object=row %}
                            </td>
                        {% endif %}
                    </tr>
                {% empty %}
                    <tr>
                        <td colspan="{% if actions_template %}{{ headers|length|add_one }}{% else %}{{ headers|length }}{% endif %}" class="text-center">
                            {{ empty_message }}
                        </td>
                    </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>
