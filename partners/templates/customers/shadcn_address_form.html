{% extends "customers/shadcn_base.html" %}

{% load crispy_forms_tags %}

{% block form_content %}
<form method="post" id="customer-form" class="space-y-6">
    {% csrf_token %}
    {{ form|crispy }}
    {{ form.media }}
    
    <div class="flex justify-between pt-4 border-t">
        <a href="{% url 'partners:customer_list' %}">
            <c-button variant="outline" type="button">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-2" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none">
                    <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
                    <path d="M5 12l14 0" />
                    <path d="M5 12l6 6" />
                    <path d="M5 12l6 -6" />
                </svg>
                Voltar
            </c-button>
        </a>
        <c-button type="submit">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-2" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none">
                <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
                <path d="M6 4h10l4 4v10a2 2 0 0 1 -2 2h-12a2 2 0 0 1 -2 -2v-12a2 2 0 0 1 2 -2" />
                <path d="M12 14m-2 0a2 2 0 1 0 4 0a2 2 0 1 0 -4 0" />
                <path d="M14 4l0 4l-6 0l0 -4" />
            </svg>
            Salvar Endere√ßo
        </c-button>
    </div>
</form>
{% endblock form_content %}

{% block extrajs %}
<script>
    $('#id_zip_code').mask('00000-000');
    
    // Busca CEP
    $('#id_zip_code').on('blur', function() {
        var cep = $(this).val().replace(/\D/g, '');
        if (cep.length === 8) {
            $.getJSON('https://viacep.com.br/ws/' + cep + '/json/', function(data) {
                if (!data.erro) {
                    $('#id_street').val(data.logradouro);
                    $('#id_neighborhood').val(data.bairro);
                    $('#id_city').val(data.localidade);
                    $('#id_state').val(data.uf);
                }
            });
        }
    });
</script>
{% endblock extrajs %}
