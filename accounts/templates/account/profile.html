{% extends "administration/base.html" %}
{% load static %}
{% load crispy_forms_tags %}

{% block title %}Meu Perfil - Gestão Fiscal{% endblock title %}

{% block content %}
<div class="px-6 pb-6 mt-6">
    <c-card>
        <c-card.content class="p-6">
            <div class="grid grid-cols-1 md:grid-cols-4 gap-6">
                <!-- Sidebar de Navegação -->
                <div class="md:col-span-1 border-r pr-6">
                    <div class="space-y-6">
                        <nav class="space-y-1 mt-4">
                            <a 
                                href="{% url 'accounts:profile' %}" class="flex items-center px-3 py-2 text-sm font-medium rounded-md bg-primary/10 text-primary border-l-2 border-primary"
                            >
                                Minha conta
                            </a>
                        </nav>
                    </div>
                </div>
                
                <!-- Conteúdo Principal -->
                <div class="md:col-span-3 pl-6 mt-5">
                    <form method="post" id="profile-form">
                        {% csrf_token %}
                        
                        <h2 class="text-xl font-semibold mb-6">Minha conta</h2>
                        
                        <div class="mb-8">
                            <h3 class="text-base font-medium mb-4">Detalhes do perfil</h3>
                            
                            <!-- Avatar -->
                            <div class="flex items-center gap-4 mb-6">
                                <div class="h-16 w-16 rounded bg-muted flex items-center justify-center overflow-hidden">
                                    {% if user.avatar %}
                                        <img src="{{ user.avatar.url }}" alt="Avatar" class="h-full w-full object-cover">
                                    {% else %}
                                        <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8 text-muted-foreground" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" fill="none">
                                            <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
                                            <path d="M8 7a4 4 0 1 0 8 0a4 4 0 0 0 -8 0" />
                                            <path d="M6 21v-2a4 4 0 0 1 4 -4h4a4 4 0 0 1 4 4v2" />
                                        </svg>
                                    {% endif %}
                                </div>
                                <div class="flex items-center gap-3">
                                    <c-button type="button" variant="outline" size="sm">
                                        Alterar avatar
                                    </c-button>
                                    <button type="button" class="text-sm text-destructive hover:text-destructive/80 font-medium">
                                        Excluir avatar
                                    </button>
                                </div>
                            </div>
                        </div>
                        
                        <div class="mb-8">
                            <h3 class="text-base font-medium mb-4">Perfil da Empresa</h3>
                            <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                                <div class="space-y-2">
                                    <label for="id_first_name" class="text-sm font-medium text-muted-foreground">Primeiro nome</label>
                                    <input 
                                        type="text" 
                                        name="first_name" 
                                        id="id_first_name"
                                        value="{{ profile_form.first_name.value|default:'' }}"
                                        class="flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50"
                                    >
                                    {% if profile_form.first_name.errors %}
                                        <p class="text-sm text-destructive">{{ profile_form.first_name.errors.0 }}</p>
                                    {% endif %}
                                </div>
                                <div class="space-y-2">
                                    <label for="id_last_name" class="text-sm font-medium text-muted-foreground">Último nome</label>
                                    <input 
                                        type="text" 
                                        name="last_name" 
                                        id="id_last_name"
                                        value="{{ profile_form.last_name.value|default:'' }}"
                                        class="flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50"
                                    >
                                    {% if profile_form.last_name.errors %}
                                        <p class="text-sm text-destructive">{{ profile_form.last_name.errors.0 }}</p>
                                    {% endif %}
                                </div>
                                <div class="space-y-2">
                                    <label class="text-sm font-medium text-muted-foreground">Empresa</label>
                                    <input 
                                        type="text" 
                                        value="{{ request.user.company_active|default:'—' }}"
                                        disabled
                                        class="flex h-10 w-full rounded-md border border-input bg-muted px-3 py-2 text-sm text-muted-foreground cursor-not-allowed"
                                    >
                                </div>
                            </div>
                        </div>
                        
                        <div class="mb-8">
                            <h3 class="text-base font-medium mb-2">E-mail</h3>
                            <p class="text-sm text-muted-foreground mb-4">
                                Este contato será exibido publicamente para outras pessoas, portanto, escolha-o com cuidado.
                            </p>
                            
                            <div class="flex items-center gap-3">
                                <input 
                                    type="email" 
                                    name="email" 
                                    id="id_email"
                                    value="{{ profile_form.email.value|default:'' }}"
                                    class="flex h-10 w-full max-w-sm rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50"
                                >
                                <c-button type="button" variant="outline" size="sm">
                                    Mudar
                                </c-button>
                            </div>
                            {% if profile_form.email.errors %}
                                <p class="text-sm text-destructive mt-2">{{ profile_form.email.errors.0 }}</p>
                            {% endif %}
                        </div>
                        
                        <div class="mb-8" x-data="{ showPasswordForm: false }">
                            <h3 class="text-base font-medium mb-2">Senha</h3>
                            <p class="text-sm text-muted-foreground mb-4">
                                Você pode definir uma senha permanente se não quiser usar códigos de login temporários.
                            </p>
                            
                            <div x-show="!showPasswordForm">
                                <a href="#" class="text-sm text-primary hover:underline" @click.prevent="showPasswordForm = true">
                                    Defina uma nova senha.
                                </a>
                            </div>
                            
                            <div x-show="showPasswordForm" x-cloak class="space-y-4 max-w-md">
                                <div class="space-y-2">
                                    <label for="id_oldpassword" class="text-sm font-medium">Senha atual</label>
                                    <input 
                                        type="password" 
                                        name="oldpassword" 
                                        id="id_oldpassword"
                                        class="flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2"
                                    >
                                </div>
                                <div class="space-y-2">
                                    <label for="id_password1" class="text-sm font-medium">Nova senha</label>
                                    <input 
                                        type="password" 
                                        name="password1" 
                                        id="id_password1"
                                        class="flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2"
                                    >
                                </div>
                                <div class="space-y-2">
                                    <label for="id_password2" class="text-sm font-medium">Confirmar nova senha</label>
                                    <input 
                                        type="password" 
                                        name="password2" 
                                        id="id_password2"
                                        class="flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2"
                                    >
                                </div>
                                <div class="flex gap-2">
                                    <c-button type="button" variant="ghost" size="sm" @click="showPasswordForm = false">
                                        Cancelar
                                    </c-button>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Botões de Ação -->
                        <div class="flex justify-end gap-3 pt-6 border-t">
                            <c-button type="submit" variant="default">
                                Salvar
                            </c-button>
                        </div>
                    </form>
                </div>
            </div>
        </c-card.content>
    </c-card>
</div>
{% endblock content %}
